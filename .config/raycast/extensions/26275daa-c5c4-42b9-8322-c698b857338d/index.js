"use strict";var x=Object.defineProperty;var ee=Object.getOwnPropertyDescriptor;var te=Object.getOwnPropertyNames;var oe=Object.prototype.hasOwnProperty;var re=(t,d)=>{for(var n in d)x(t,n,{get:d[n],enumerable:!0})},ne=(t,d,n,u)=>{if(d&&typeof d=="object"||typeof d=="function")for(let v of te(d))!oe.call(t,v)&&v!==n&&x(t,v,{get:()=>d[v],enumerable:!(u=ee(d,v))||u.enumerable});return t};var ie=t=>ne(x({},"__esModule",{value:!0}),t);var ue={};re(ue,{default:()=>K});module.exports=ie(ue);var r=require("@raycast/api");var w=require("react"),C=require("child_process"),m=require("@raycast/api");function M(){let{sortBy:t,hideInvalidDevices:d}=(0,m.getPreferenceValues)(),[n,u]=(0,w.useState)(!0),[v,k]=(0,w.useState)(void 0),[p,f]=(0,w.useState)({}),[A,O]=(0,w.useState)({}),[S,N]=(0,w.useState)({});(0,w.useEffect)(()=>{(async()=>{let s=await se(),o=await ce();O(s),N(o),await G(s,o)})()},[]);let F=async(e,s)=>{let o=e.name.replace(/"/g,'\\"'),i=s==="connecting"?`/usr/sbin/networksetup -connectpppoeservice "${o}"`:`/usr/sbin/networksetup -disconnectpppoeservice "${o}"`;try{await L(i),f(g=>({...g,[e.id]:{...e,status:s}}));let a=await P(e);f(g=>({...g,[e.id]:{...e,status:a}}))}catch(a){k(a)}},c=async e=>{try{let s=await b(e.name);f(o=>({...o,[e.id]:{...e,status:s}}))}catch(s){k(s)}},P=e=>new Promise(s=>{let o=async()=>{try{let i=await b(e.name);i==="connected"||i==="disconnected"?s(i):setTimeout(o,500)}catch{setTimeout(o,500)}};o()}),V=async e=>{let s={...A,[e.id]:!0};O(s),j(s);let o={...S,[e.id]:Object.keys(S).length};N(o),T(o),f(i=>({...i,[e.id]:{...e,favorite:!0,order:o[e.id]}}))},W=async e=>{let s={...A};delete s[e.id],O(s),j(s);let o={...S};delete o[e.id],N(o),T(o),f(i=>({...i,[e.id]:{...e,favorite:!1,order:0}}))},H=e=>{let s=Object.keys(S).sort((i,a)=>S[i]-S[a]),o=s.indexOf(e.id);if(o>0){let i=s[o-1],a={...S},g=a[i];a[i]=a[e.id],a[e.id]=g,N(a),T(a),f(h=>({...h,[e.id]:{...e,order:a[e.id]},[i]:{...h[i],order:a[i]}}))}},_=e=>{let s=Object.keys(S).sort((i,a)=>S[i]-S[a]),o=s.indexOf(e.id);if(o<s.length-1){let i=s[o+1],a={...S},g=a[i];a[i]=a[e.id],a[e.id]=g,N(a),T(a),f(h=>({...h,[e.id]:{...e,order:a[e.id]},[i]:{...h[i],order:a[i]}}))}},$=e=>F(e,"connecting"),z=e=>F(e,"disconnecting"),G=async(e,s)=>{try{let o=await ae(),i=["Wi-Fi","Bluetooth PAN","Thunderbolt Bridge"],g=o.split(`
`).slice(1).join(`
`),h=de(g).filter(y=>!i.includes(y.name)),Z=(await Promise.all(h.map(y=>b(y.name).then(E=>({...y,status:E,favorite:!!e[y.id],order:s[y.id]??0}))))).reduce((y,E)=>({...y,[E.id]:E}),{});f(Z)}catch(o){k(o)}finally{u(!1)}},X=e=>({disconnected:{actionName:"Connect",action:()=>$(e),icon:m.Icon.Circle},connected:{actionName:"Disconnect",action:()=>z(e),icon:m.Icon.Checkmark},connecting:{actionName:void 0,action:void 0,icon:m.Icon.CircleEllipsis},disconnecting:{actionName:void 0,action:void 0,icon:m.Icon.CircleEllipsis},invalid:{actionName:void 0,action:void 0,icon:m.Icon.XMarkCircle}})[e.status]||{icon:m.Icon.XMarkCircle},Y=(0,w.useMemo)(()=>I(Object.values(p).filter(e=>e.favorite),t),[p,t]),q=(0,w.useMemo)(()=>I(Object.values(p).filter(e=>!e.favorite&&e.status!=="invalid"),t),[p,t]),Q=(0,w.useMemo)(()=>I(Object.values(p).filter(e=>e.status==="invalid"),t),[p,t]);return{isLoading:n,error:v,favoriteServices:Y,otherServices:q,invalidServices:Q,fetchServiceStatus:c,addToFavorites:V,removeFromFavorites:W,moveFavoriteUp:H,moveFavoriteDown:_,getActionForService:X,hideInvalidDevices:d}}function D(t,d){return{"com.wireguard.macos":"WireGuard",[d]:""}[t]||t}function U(){(0,C.exec)("open x-apple.systempreferences:com.apple.Network-Settings.extension",t=>{t&&(0,m.showToast)({title:"Error",message:"Could not open Network Settings",style:m.Toast.Style.Failure})})}var I=(t,d)=>t.sort((n,u)=>{if(R.includes(n.status)&&!R.includes(u.status))return-1;if(!R.includes(n.status)&&R.includes(u.status))return 1;if(n.favorite&&!u.favorite)return-1;if(!n.favorite&&u.favorite)return 1;if(n.favorite&&u.favorite)return n.order-u.order;if(n.status==="invalid")return 1;if(u.status==="invalid")return-1;let v=d.startsWith("asc")?1:-1,k=n.name,p=u.name;d.includes("Type")&&(k=D(n.hardwarePort,n.name),p=D(u.hardwarePort,u.name));let f=k.localeCompare(p)*v;return f===0?n.name.localeCompare(u.name)*v:f}),B="network-service-favorites",J="network-service-favorites-order",se=async()=>{let t=await m.LocalStorage.getItem(B);return t?JSON.parse(t):{}},j=async t=>{await m.LocalStorage.setItem(B,JSON.stringify(t))},ce=async()=>{let t=await m.LocalStorage.getItem(J);return t?JSON.parse(t):{}},T=async t=>{await m.LocalStorage.setItem(J,JSON.stringify(t))},L=t=>new Promise((d,n)=>{(0,C.exec)(t,(u,v)=>{u?n(u):d(v.trim())})}),ae=()=>L("/usr/sbin/networksetup -listnetworkserviceorder"),de=t=>{let d=/\((\d+)\)\s+(.*?)\s+\(Hardware Port: (.*?), Device: (.*?)\)/g;return Array.from(t.matchAll(d)).map(n=>({id:n[1],name:n[2],hardwarePort:n[3],device:n[4],status:"disconnected",favorite:!1,order:0}))},b=t=>(t=t.replace(/"/g,'\\"'),L(`/usr/sbin/networksetup -showpppoestatus "${t}"`)),R=["connected","connecting","disconnecting"];var l=require("react/jsx-runtime");function K(){let{isLoading:t,error:d,favoriteServices:n,invalidServices:u,otherServices:v,fetchServiceStatus:k,addToFavorites:p,removeFromFavorites:f,moveFavoriteUp:A,moveFavoriteDown:O,hideInvalidDevices:S,getActionForService:N}=M();return d&&(0,r.showToast)(r.Toast.Style.Failure,"Something went wrong",d.message),(0,l.jsxs)(r.List,{isLoading:t,children:[n.length>0&&(0,l.jsx)(r.List.Section,{title:"Favorites",children:n.map(c=>(0,l.jsx)(F,{service:c},c.id))}),v.length>0&&(0,l.jsx)(r.List.Section,{title:"VPN Services",children:v.map(c=>(0,l.jsx)(F,{service:c},c.id))}),!S&&u.length>0&&(0,l.jsx)(r.List.Section,{title:"Other Services",children:u.map(c=>(0,l.jsx)(F,{service:c},c.id))})]});function F({service:c}){let P=N(c);return(0,l.jsx)(r.List.Item,{icon:P.icon,title:c.name,subtitle:D(c.hardwarePort,c.name),accessories:c.favorite?[{icon:r.Icon.Star}]:[],actions:(0,l.jsxs)(r.ActionPanel,{children:[P.actionName&&(0,l.jsx)(r.Action,{title:P.actionName,onAction:P.action,icon:c.status==="connected"?r.Icon.Eject:r.Icon.Plug}),(0,l.jsx)(r.Action,{title:"Refresh",onAction:()=>k(c),icon:r.Icon.ArrowClockwise}),(0,l.jsx)(r.Action,{title:"Open Network Settings",onAction:U,icon:r.Icon.Gear,shortcut:{modifiers:["cmd","shift"],key:"n"}}),(0,l.jsx)(r.Action,{title:c.favorite?"Remove from Favorites":"Add to Favorites",onAction:()=>c.favorite?f(c):p(c),icon:c.favorite?r.Icon.Star:r.Icon.Star,shortcut:{modifiers:["cmd","shift"],key:"f"}}),c.favorite&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(r.Action,{title:"Move Up in Favorites",onAction:()=>A(c),icon:r.Icon.ArrowUp,shortcut:{modifiers:["cmd","opt"],key:"arrowUp"}}),(0,l.jsx)(r.Action,{title:"Move Down in Favorites",onAction:()=>O(c),icon:r.Icon.ArrowDown,shortcut:{modifiers:["cmd","opt"],key:"arrowDown"}})]})]})})}}
