"use strict";var T=Object.defineProperty;var ee=Object.getOwnPropertyDescriptor;var te=Object.getOwnPropertyNames;var re=Object.prototype.hasOwnProperty;var oe=(t,c)=>{for(var r in c)T(t,r,{get:c[r],enumerable:!0})},ne=(t,c,r,a)=>{if(c&&typeof c=="object"||typeof c=="function")for(let l of te(c))!re.call(t,l)&&l!==r&&T(t,l,{get:()=>c[l],enumerable:!(a=ee(c,l))||a.enumerable});return t};var ie=t=>ne(T({},"__esModule",{value:!0}),t);var ue={};oe(ue,{default:()=>J});module.exports=ie(ue);var p=require("@raycast/api");var w=require("react"),b=require("child_process"),u=require("@raycast/api");function B(){let{sortBy:t,hideInvalidDevices:c}=(0,u.getPreferenceValues)(),[r,a]=(0,w.useState)(!0),[l,k]=(0,w.useState)(void 0),[m,S]=(0,w.useState)({}),[h,d]=(0,w.useState)({}),[v,P]=(0,w.useState)({});(0,w.useEffect)(()=>{(async()=>{let i=await se(),o=await ce();d(i),P(o),await Y(i,o)})()},[]);let D=async(e,i)=>{let o=e.name.replace(/"/g,'\\"'),n=i==="connecting"?`/usr/sbin/networksetup -connectpppoeservice "${o}"`:`/usr/sbin/networksetup -disconnectpppoeservice "${o}"`;try{await C(n),S(g=>({...g,[e.id]:{...e,status:i}}));let s=await V(e);S(g=>({...g,[e.id]:{...e,status:s}}))}catch(s){k(s)}},K=async e=>{try{let i=await R(e.name);S(o=>({...o,[e.id]:{...e,status:i}}))}catch(i){k(i)}},V=e=>new Promise(i=>{let o=async()=>{try{let n=await R(e.name);n==="connected"||n==="disconnected"?i(n):setTimeout(o,500)}catch{setTimeout(o,500)}};o()}),W=async e=>{let i={...h,[e.id]:!0};d(i),A(i);let o={...v,[e.id]:Object.keys(v).length};P(o),F(o),S(n=>({...n,[e.id]:{...e,favorite:!0,order:o[e.id]}}))},H=async e=>{let i={...h};delete i[e.id],d(i),A(i);let o={...v};delete o[e.id],P(o),F(o),S(n=>({...n,[e.id]:{...e,favorite:!1,order:0}}))},_=e=>{let i=Object.keys(v).sort((n,s)=>v[n]-v[s]),o=i.indexOf(e.id);if(o>0){let n=i[o-1],s={...v},g=s[n];s[n]=s[e.id],s[e.id]=g,P(s),F(s),S(y=>({...y,[e.id]:{...e,order:s[e.id]},[n]:{...y[n],order:s[n]}}))}},$=e=>{let i=Object.keys(v).sort((n,s)=>v[n]-v[s]),o=i.indexOf(e.id);if(o<i.length-1){let n=i[o+1],s={...v},g=s[n];s[n]=s[e.id],s[e.id]=g,P(s),F(s),S(y=>({...y,[e.id]:{...e,order:s[e.id]},[n]:{...y[n],order:s[n]}}))}},z=e=>D(e,"connecting"),X=e=>D(e,"disconnecting"),Y=async(e,i)=>{try{let o=await ae(),n=["Wi-Fi","Bluetooth PAN","Thunderbolt Bridge"],g=o.split(`
`).slice(1).join(`
`),y=de(g).filter(N=>!n.includes(N.name)),Z=(await Promise.all(y.map(N=>R(N.name).then(O=>({...N,status:O,favorite:!!e[N.id],order:i[N.id]??0}))))).reduce((N,O)=>({...N,[O.id]:O}),{});S(Z)}catch(o){k(o)}finally{a(!1)}},G=e=>({disconnected:{actionName:"Connect",action:()=>z(e),icon:u.Icon.Circle},connected:{actionName:"Disconnect",action:()=>X(e),icon:u.Icon.Checkmark},connecting:{actionName:void 0,action:void 0,icon:u.Icon.CircleEllipsis},disconnecting:{actionName:void 0,action:void 0,icon:u.Icon.CircleEllipsis},invalid:{actionName:void 0,action:void 0,icon:u.Icon.XMarkCircle}})[e.status]||{icon:u.Icon.XMarkCircle},U=(0,w.useMemo)(()=>I(Object.values(m).filter(e=>e.favorite),t),[m,t]),q=(0,w.useMemo)(()=>I(Object.values(m).filter(e=>!e.favorite&&e.status!=="invalid"),t),[m,t]),Q=(0,w.useMemo)(()=>I(Object.values(m).filter(e=>e.status==="invalid"),t),[m,t]);return{isLoading:r,error:l,favoriteServices:U,otherServices:q,invalidServices:Q,fetchServiceStatus:K,addToFavorites:W,removeFromFavorites:H,moveFavoriteUp:_,moveFavoriteDown:$,getActionForService:G,hideInvalidDevices:c}}function x(t,c){return{"com.wireguard.macos":"WireGuard",[c]:""}[t]||t}function M(){(0,b.exec)("open x-apple.systempreferences:com.apple.Network-Settings.extension",t=>{t&&(0,u.showToast)({title:"Error",message:"Could not open Network Settings",style:u.Toast.Style.Failure})})}var I=(t,c)=>t.sort((r,a)=>{if(E.includes(r.status)&&!E.includes(a.status))return-1;if(!E.includes(r.status)&&E.includes(a.status))return 1;if(r.favorite&&!a.favorite)return-1;if(!r.favorite&&a.favorite)return 1;if(r.favorite&&a.favorite)return r.order-a.order;if(r.status==="invalid")return 1;if(a.status==="invalid")return-1;let l=c.startsWith("asc")?1:-1,k=r.name,m=a.name;c.includes("Type")&&(k=x(r.hardwarePort,r.name),m=x(a.hardwarePort,a.name));let S=k.localeCompare(m)*l;return S===0?r.name.localeCompare(a.name)*l:S}),j="network-service-favorites",L="network-service-favorites-order",se=async()=>{let t=await u.LocalStorage.getItem(j);return t?JSON.parse(t):{}},A=async t=>{await u.LocalStorage.setItem(j,JSON.stringify(t))},ce=async()=>{let t=await u.LocalStorage.getItem(L);return t?JSON.parse(t):{}},F=async t=>{await u.LocalStorage.setItem(L,JSON.stringify(t))},C=t=>new Promise((c,r)=>{(0,b.exec)(t,(a,l)=>{a?r(a):c(l.trim())})}),ae=()=>C("/usr/sbin/networksetup -listnetworkserviceorder"),de=t=>{let c=/\((\d+)\)\s+(.*?)\s+\(Hardware Port: (.*?), Device: (.*?)\)/g;return Array.from(t.matchAll(c)).map(r=>({id:r[1],name:r[2],hardwarePort:r[3],device:r[4],status:"disconnected",favorite:!1,order:0}))},R=t=>(t=t.replace(/"/g,'\\"'),C(`/usr/sbin/networksetup -showpppoestatus "${t}"`)),E=["connected","connecting","disconnecting"];var f=require("react/jsx-runtime");function J(){let{isLoading:t,error:c,favoriteServices:r,invalidServices:a,otherServices:l,getActionForService:k,hideInvalidDevices:m}=B();c&&(0,p.showToast)(p.Toast.Style.Failure,"Something went wrong",c.message);let S=[...r,...l,...m?[]:a].some(d=>d.status==="connected");return(0,f.jsxs)(p.MenuBarExtra,{icon:S?"network-connected.png":"network-disconnected.png",tooltip:"Network Services",isLoading:t,children:[r.length>0&&(0,f.jsx)(p.MenuBarExtra.Section,{title:"Favorites",children:r.map(d=>(0,f.jsx)(h,{service:d},d.id))}),l.length>0&&(0,f.jsx)(p.MenuBarExtra.Section,{title:"VPN Services",children:l.map(d=>(0,f.jsx)(h,{service:d},d.id))}),!m&&a.length>0&&(0,f.jsx)(p.MenuBarExtra.Section,{title:"Other Services",children:a.map(d=>(0,f.jsx)(h,{service:d},d.id))}),(0,f.jsx)(p.MenuBarExtra.Section,{children:(0,f.jsx)(p.MenuBarExtra.Item,{title:"Open Network Settings\u2026",onAction:M})})]});function h({service:d}){let v=k(d);return(0,f.jsx)(p.MenuBarExtra.Item,{icon:v.icon,title:d.name,subtitle:x(d.hardwarePort,d.name),onAction:v.action})}}
